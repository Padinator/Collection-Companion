name: Create tag on pull request merge
on:
  push:
    branches: ["main"]
  pull_request:
    types:
      - closed
    branches:
      - main
jobs:
  create-tag:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Check pull request status ðŸ§ª
        run: |
        
          #git tag "$BRANCH_NAME"
          #git push origin "$BRANCH_NAME"
        
          #if [ "${{ github.event.pull_request.merged }}" = true ]; then
            echo "Creating tag"
            # Get the latest commit message
            COMMIT_MESSAGE=$(git log -1 --pretty=%B)
            
            # Replace spaces with underscores in the tag name
            TAG_NAME=$(echo "$COMMIT_MESSAGE" | tr ' ' '_')
            
            # Create the tag
            git tag "$TAG_NAME" 
            
            # Push the tag to the remote repository
            git push origin "$TAG_NAME"

            docker-compose up -d --build --force-recreate
          fi
          
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
